/* eslint-disable @typescript-eslint/ban-ts-comment */
import { Menu, Transition } from '@headlessui/react';
import { EllipsisVerticalIcon } from '@heroicons/react/20/solid';
import { Fragment } from 'react';
import { useParams } from 'react-router-dom';

import { trpc } from '../../trpc';

const statuses = {
	Complete: 'text-green-700 bg-green ring-green-600/20',
	'In progress': 'text-gray-600 bg-gray ring-gray-600/20',
	Archived: 'text-yellow-800 bg-yellow ring-yellow-600/20',
};

function classNames(...classes: any[]) {
	return classes.filter(Boolean).join(' ');
}

export const UserStoriesList = () => {
	const { projectId } = useParams<{ projectId: string }>();
	const userStoriesQuery = trpc.userStories.getUserStories.useQuery(
		{
			projectId: projectId!,
		},
		{
			enabled: !!projectId,
			staleTime: 1000,
			retry: (retry, error) => {
				return retry < 3 && !error.data?.code;
			},
		}
	);
	const userStories = userStoriesQuery.data;
	console.log('userStories:', userStories);

	return (
		<ul role="list" className="divide-y divide-gray-800">
			{userStories?.map((project) => {
				// @ts-ignore
				const status = statuses[project.status];

				return (
					<li key={project.id} className="flex items-center justify-between gap-x-6 py-5">
						<div className="min-w-0">
							<div className="flex items-start gap-x-3">
								<p className="text-sm font-semibold leading-6 text-white">{project.name}</p>
								<p
									className={classNames(
										status,
										'rounded-md whitespace-nowrap mt-0.5 px-1.5 py-0.5 text-xs font-medium ring-1 ring-inset'
									)}
								>
									{project.status}
								</p>
							</div>
							<div className="mt-1 flex items-center gap-x-2 text-xs leading-5 text-gray-500">
								<p className="whitespace-nowrap">
									Due on <time dateTime={project.dueDateTime}>{project.dueDate}</time>
								</p>
								<svg viewBox="0 0 2 2" className="h-0.5 w-0.5 fill-current">
									<circle cx={1} cy={1} r={1} />
								</svg>
								<p className="truncate">Created by {project.createdBy}</p>
							</div>
						</div>
						<div className="flex flex-none items-center gap-x-4">
							<a
								href={project.href}
								className="rounded-md bg-white/10 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-white/20"
							>
								View project<span className="sr-only">, {project.name}</span>
							</a>
							<Menu as="div" className="relative flex-none">
								<Menu.Button className="-m-2.5 block p-2.5 text-gray-500 hover:text-white">
									<span className="sr-only">Open options</span>
									<EllipsisVerticalIcon className="h-5 w-5" aria-hidden="true" />
								</Menu.Button>
								<Transition
									as={Fragment}
									enter="transition ease-out duration-100"
									enterFrom="transform opacity-0 scale-95"
									enterTo="transform opacity-100 scale-100"
									leave="transition ease-in duration-75"
									leaveFrom="transform opacity-100 scale-100"
									leaveTo="transform opacity-0 scale-95"
								>
									<Menu.Items className="absolute right-0 z-10 mt-2 w-32 origin-top-right rounded-md bg-slate-700 py-2 shadow-lg ring-1 ring-gray-900/5 focus:outline-none">
										<Menu.Item>
											{({ active }) => (
												<a
													href="#"
													className={classNames(
														active ? 'bg-slate-600' : 'bg-slate-700',
														'block px-3 py-1 text-sm leading-6 text-white'
													)}
												>
													Edit<span className="sr-only">, {project.name}</span>
												</a>
											)}
										</Menu.Item>
										<Menu.Item>
											{({ active }) => (
												<a
													href="#"
													className={classNames(
														active ? 'bg-slate-600' : 'bg-slate-700',
														'block px-3 py-1 text-sm leading-6 text-white'
													)}
												>
													Move<span className="sr-only">, {project.name}</span>
												</a>
											)}
										</Menu.Item>
										<Menu.Item>
											{({ active }) => (
												<a
													href="#"
													className={classNames(
														active ? 'bg-slate-600' : 'bg-slate-700',
														'block px-3 py-1 text-sm leading-6 text-white'
													)}
												>
													Delete<span className="sr-only">, {project.name}</span>
												</a>
											)}
										</Menu.Item>
									</Menu.Items>
								</Transition>
							</Menu>
						</div>
					</li>
				);
			})}
		</ul>
	);
};
