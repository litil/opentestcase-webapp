export const postPrompt = async (messages: { role: string; content: string }[]) => {
	const aggregatedResponse = [];
	try {
		const myHeaders = new Headers();
		myHeaders.append('Accept', 'application/json');

		const requestOptions = {
			method: 'POST',
			headers: myHeaders,
			redirect: 'follow' as RequestRedirect,
			body: JSON.stringify({ messages }),
		};
		const req = await fetch(
			'https://ki4ja62ih7gbi3dqg35fvezlnq0eloxi.lambda-url.eu-west-3.on.aws',
			requestOptions
		);
		
			console.log('TEST req', req);

		if (!req.body) { 
			console.error('Error fetching data: req.body is undefined');
			
			return;
		}
		
		const reader = req.body.getReader();
		console.log('TEST reader', reader);

		while (true) {
			const { done, value } = await reader.read();
			console.log('TEST { done, value }', { done, value })

			if (done) {
				break;
			}

			// Handle each chunk of data
			const chunkText = new TextDecoder('utf-8').decode(value);

			console.log('chunkText:', chunkText);
			
			aggregatedResponse.push(chunkText);
			

			// Optionally, you can process the chunk further or update your UI
		}
	} catch (error) {
		console.error('Error fetching data:', error);
	}

	// const myHeaders = new Headers();
	// myHeaders.append('Accept', 'application/json');

	// const requestOptions = {
	// 	method: 'POST',
	// 	headers: myHeaders,
	// 	redirect: 'follow' as RequestRedirect,
	// 	body: JSON.stringify({ messages }),
	// };

	// const req = await fetch(
	// 	'https://ki4ja62ih7gbi3dqg35fvezlnq0eloxi.lambda-url.eu-west-3.on.aws',
	// 	requestOptions
	// );
	// const res = await req.json();

	// console.log('Post prompt - res:', res);

	// return res;

	return { choices: [{ message: { content: aggregatedResponse[0] } }] };
};
